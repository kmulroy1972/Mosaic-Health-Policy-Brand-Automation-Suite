# Accessibility Audit Report

**Last Updated:** 2025-01-27  
**Generated By:** Mosaic Health Policy Brand Automation Suite  
**Compliance Standard:** WCAG 2.1 Level AA

## Summary

This document tracks accessibility compliance for all documents and web content processed through the Mosaic Brand Automation system.

## Compliance Endpoint

**POST** `/api/compliance/validate`

Validates accessibility of PDF, HTML, and DOCX documents.

### Request Format

```json
{
  "content": "base64-encoded-document-content",
  "contentType": "pdf" | "html" | "docx",
  "url": "optional-url-for-report-generation"
}
```

### Response Format

```json
{
  "violations": [
    {
      "rule": "image-alt",
      "severity": "error",
      "description": "Images must have alternative text",
      "wcagLevel": "A",
      "element": "image-1",
      "html": "<img src='...'>"
    }
  ],
  "wcagScore": 85,
  "reportUrl": "https://...",
  "timestamp": "2025-01-27T12:00:00.000Z",
  "documentType": "html"
}
```

## Validation Rules

### WCAG Level A (Critical)

| Rule ID          | Description                             | Severity | Deduction    |
| ---------------- | --------------------------------------- | -------- | ------------ |
| `document-title` | Document must have a title element      | error    | -15          |
| `html-has-lang`  | HTML element must have a lang attribute | error    | -10          |
| `image-alt`      | Images must have alternative text       | error    | -5 per image |
| `label`          | Form fields must have associated labels | error    | -5 per field |
| `pdf-text-layer` | PDF must have searchable text layer     | error    | -20          |
| `pdf-structure`  | PDF must have valid structure           | critical | -50          |

### WCAG Level AA (Important)

| Rule ID          | Description                                      | Severity | Deduction     |
| ---------------- | ------------------------------------------------ | -------- | ------------- |
| `heading-order`  | Document should have proper heading hierarchy    | warning  | -5            |
| `color-contrast` | Ensure sufficient color contrast (4.5:1)         | warning  | 0 (info only) |
| `pdf-tagged`     | PDF should be tagged for accessibility (PDF/UA)  | warning  | -10           |
| `pdf-metadata`   | PDF should include metadata (title, author)      | warning  | -5            |
| `docx-headings`  | Use proper heading styles for document structure | info     | 0             |

### WCAG Level AAA (Enhanced)

Currently not enforced, but violations are reported as informational.

## Scoring Algorithm

- **Starting Score:** 100
- **Critical Violations:** -50 points
- **Error Violations:** -5 to -20 points (depending on rule)
- **Warning Violations:** -5 to -10 points (depending on rule)
- **Info Violations:** 0 points (reported but not scored)
- **Final Score:** Clamped between 0-100

## Document Type Support

### HTML Documents

- ✅ Document title validation
- ✅ Language attribute validation
- ✅ Image alt text validation
- ✅ Form label association
- ✅ Heading hierarchy check
- ✅ Color contrast warnings
- ⚠️ Full axe-core integration (pending)

### PDF Documents

- ✅ PDF structure validation
- ✅ Text layer detection
- ✅ Tagged PDF (PDF/UA) check
- ✅ Metadata validation
- ⚠️ Full Apryse SDK integration (pending)
- ⚠️ PAC 3 CLI integration (pending)

### DOCX Documents

- ✅ Document structure validation
- ⚠️ Alt text validation (basic)
- ⚠️ Heading style validation (basic)
- ⚠️ Full DOCX parser integration (pending)

## Nightly Compliance Job

**Schedule:** Daily at 2:00 AM UTC  
**Function:** `nightlyComplianceJob`

### Process

1. Query recent documents (last 24 hours) from Cosmos DB
2. Re-run accessibility validation on each document
3. Update audit logs with latest compliance scores
4. Generate summary report and store in blob storage
5. Send Teams notification if critical violations found

### Status

⚠️ **Implementation Pending:** Currently a stub that logs job execution. Full integration requires:

- Cosmos DB connection
- Blob storage for reports
- Teams notification integration

## Recent Audit Results

| Date       | Documents Scanned | Avg WCAG Score | Critical Issues | Errors | Warnings |
| ---------- | ----------------- | -------------- | --------------- | ------ | -------- |
| 2025-01-27 | 0                 | N/A            | 0               | 0      | 0        |

_Note: Nightly job not yet connected to document database._

## Integration Roadmap

### Phase 7 (Current) ✅

- [x] Basic HTML validation (title, lang, images, forms)
- [x] Basic PDF validation (structure, text layer, tags)
- [x] Basic DOCX validation (structure)
- [x] HTTP endpoint `/api/compliance/validate`
- [x] Scheduled function `nightlyComplianceJob`
- [x] Scoring algorithm implementation

### Phase 8+ (Future)

- [ ] Full axe-core integration with headless browser
- [ ] Apryse SDK integration for PDF/UA compliance
- [ ] PAC 3 CLI integration for PDF accessibility
- [ ] Full DOCX parser with style validation
- [ ] Cosmos DB integration for audit logs
- [ ] Blob storage integration for reports
- [ ] Teams notification for critical violations
- [ ] Historical trend analysis
- [ ] Custom compliance rules configuration

## Usage Examples

### Validate HTML Document

```bash
curl -X POST https://mhpbrandfunctions38e5971a.azurewebsites.net/api/compliance/validate \
  -H "Content-Type: application/json" \
  -d '{
    "content": "SG1sPHRpdGxlPlRlc3Q8L3RpdGxlPjwvaHRtbD4=",
    "contentType": "html"
  }'
```

### Validate PDF Document

```bash
curl -X POST https://mhpbrandfunctions38e5971a.azurewebsites.net/api/compliance/validate \
  -H "Content-Type: application/json" \
  -d '{
    "content": "<base64-pdf-content>",
    "contentType": "pdf",
    "url": "https://example.com/document.pdf"
  }'
```

## Compliance Standards

- **WCAG 2.1 Level A:** Minimum required
- **WCAG 2.1 Level AA:** Target standard (Section 508 compliant)
- **WCAG 2.1 Level AAA:** Enhanced (optional)

## References

- [WCAG 2.1 Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)
- [Section 508 Standards](https://www.section508.gov/)
- [PDF/UA Standard (ISO 14289)](https://www.pdfa.org/pdf-ua-the-iso-standard-for-universal-accessibility/)
- [PAC 3 - PDF Accessibility Checker](https://www.access-for-all.ch/en/pdf-lab/pdf-accessibility-checker-pac.html)
